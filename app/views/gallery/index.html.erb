<body class="gallery">

<div class="gallery-container">
  <h1>photos.</h1>

  <div class="swiper mySwiper" data-controller="swiper">
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <%= image_tag "CHILD (BOLD:YELLOW).png", alt: "Child Image", class: "gallery-image" %>
        <div class="by">
        <p>Photo by Eva Rut.</p>
        </div>
      </div>

      <div class="swiper-slide">
        <%= image_tag "Portrait 1.png", alt: "Portrait-Gallery Image", class: "gallery-image" %>
        <div class="by">
        <p>Photo by Eva Rut.</p>
        </div>
      </div>

      <div class="swiper-slide">
        <%= image_tag "Girl Like You - Cover.jpg", alt: "GLY Image", class: "gallery-image" %>
        <div class="by">
        <p>Photo/Design by Atli Sigursveinsson.</p>
        </div>
      </div>
      <div class="swiper-slide">
        <%= image_tag "You-Cover.jpg", alt: "YOU Image", class: "gallery-image" %>
        <div class="by">
        <p>Photo/Design by Atli Sigursveinsson.</p>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>

    <!-- Pagination -->
    <div class="swiper-pagination"></div>
  </div>
</div>

<script>
function initializeSwiper() {
  console.log("✅ Reinitializing Swiper!");

  const swiper = new Swiper(".mySwiper", {
    loop: true,
    slidesPerView: 1,
    spaceBetween: 20,
    lazy: true,
    effect: "cube", // ✅ Enables 3D cube rotation
    speed: 1000, // ✅ Slows down transition (1000ms = 1 second)
    cubeEffect: {
      shadow: true,
      slideShadows: true,
      shadowOffset: 20,
      shadowScale: 0.9,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    on: {
      slideChangeTransitionEnd: function () {
        adjustButtonPositions(swiper);
      },
    },
  });

  adjustButtonPositions(swiper); // Ensure correct position on first load
}

function adjustButtonPositions(swiper) {
  const activeSlide = swiper.slides[swiper.activeIndex]; // Get current slide
  const image = activeSlide.querySelector("img");

  if (image) {
    const imageHeight = image.clientHeight; // Get image height
    const offset = 20; // Adjust as needed

    // Adjust navigation button position
    document.querySelector(".swiper-button-next").style.top = `${imageHeight / 2 + offset}px`;
    document.querySelector(".swiper-button-prev").style.top = `${imageHeight / 2 + offset}px`;

    // Adjust pagination position below the image
    document.querySelector(".swiper-pagination").style.top = `${imageHeight + offset * 2}px`;
  }
}

// ✅ Ensure Swiper initializes properly on page load and Turbo navigation
document.addEventListener("DOMContentLoaded", initializeSwiper);
document.addEventListener("turbo:load", initializeSwiper);

</script>


</body>
