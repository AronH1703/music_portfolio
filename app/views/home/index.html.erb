<body>
<div id="video-overlay">
  <video id="loader" class="vhs-noise-video" autoplay muted playsinline preload="auto" webkit-playsinline>
    <source src="<%= asset_path('VHS Web_ntsc-HS.mp4') %>" type="video/mp4">
    Your browser does not support the video tag.
  </video>
</div>

<div class="paper-texture"></div>
<div class="noise-texture"></div>
<div class="grain-texture"></div>


<div class="vhs-noise-overlay"></div>

<div class="scroll-wrapper" data-controller="scroll-animation">

  <section class="scroll-selection-nav">
    <%= render "shared/navbar" %>
  </section>

  <section class="scroll-selection">
    <div class="kassi-container" data-controller="kassi-scroll">
      <%= image_tag "kassi.png", alt: "Kassi Image", class: "kassi-image" %>
    </div>


    <div class="backdrop-title" data-controller="kassi-scroll">
      <h1 class="title-aron">ARON</h1>
      <h1 class="title-hannes">HANNES</h1>
    </div>
  </section>


  <%# <section class="scroll-selection" >
  <div style="background-color: red; height: 100vh;">
    </div>
  </section> %>

  <section class="scroll-selection" id="about">
  <div class="about-row">
    <%= image_tag "Portrait 1.png", alt: "About Image", class: "about-image" %>
    <div class="about-text">
      <h3>ABouT</h3>
      <div class="upper-text">
        <p>Aron Hannes is an Icelandic artist and songwriter crafting a unique blend of Alt-Soul and Indie R&B. With deep roots in storytelling, he merges raw emotion with dynamic melodies, creating music that feels both intimate and expansive. Drawing inspiration from R&B, soul, pop, and gospel, his sound is ever-evolvingâ€”pushing boundaries while staying true to his artistic vision. Known for his versatility and passion for honest, genre-blurring music, Aron brings a distinct voice to the alternative R&B scene. Whether writing for himself or collaborating with others, his dedication to growth and authenticity continues to shape his journey as an artist.</p>
      </div>
    </div>
  </div>
</section>

<div class="scroll-selection" id="fullpage">
  <section class="fullpage-section threejs-section" data-gsap-scroll-target="section">
    <div id="three-container" data-controller="three"></div>
  </section>
</div>

<section class="scroll-selection" id="music-platforms" data-gsap-scroll-target="section">
    <ul class="music-list">
      <li>
        <a href="https://open.spotify.com/artist/3YWoe6haPoiQdq7GaQz2OR?si=eaM94hB-SkGdMmlK50nF4A" target="_blank">
          <%= image_tag "Spotify.svg", alt: "Spotify" %>
          SPOTIFY
        </a>
      </li>
      <li>
        <a href="https://music.apple.com/is/artist/aron-hannes/820717161" target="_blank">
          <%= image_tag "applemusic.svg", alt: "Apple Music" %>
          APPLE MUSIC
        </a>
      </li>
      <li>
        <a href="https://deezer.page.link/XSZdQHGWG5SsZhzE7" target="_blank">
          <%= image_tag "deezer.svg", alt: "Deezer" %>
          DEEZER
        </a>
      </li>
      <li>
        <a href="https://music.youtube.com/channel/UCG5wQ2UMfLYD5lp8MAbk6Zg?si=Se8nOTEe2Vvr014o" target="_blank">
          <%= image_tag "youtube-music.svg", alt: "YouTube Music" %>
          YOUTUBE MUSIC
        </a>
      </li>
      <li>
        <a href="https://tidal.com/browse/artist/7421898" target="_blank">
          <%= image_tag "tidal.svg", alt: "Tidal" %>
          TIDAL
        </a>
      </li>
    </ul>
  </section>



  <section class="scroll-selection-footer">
<%= render "shared/footer" %>
</section>

</div>
</body>


<script>

document.addEventListener("turbo:load", () => {
  console.log("ðŸš€ Turbo Load virkar!!!");

  const video = document.getElementById("loader");
  const videoOverlay = document.getElementById("video-overlay");

  console.log("ðŸŽ¥ Video element:", video); // Add this line
  console.log("ðŸ–¼ï¸ Video overlay element:", videoOverlay); // Add this line

  if (!video || !videoOverlay) {
    console.warn("âš ï¸ Ekkert mp4!! ðŸ˜¬ Exiting script...");
    return;
  }

  console.log("ðŸ“¦ sessionStorage vhsPlayed:", sessionStorage.getItem("vhsPlayed"));

  // Check if the video has already played in this session
  if (sessionStorage.getItem("vhsPlayed") === "true") {
    console.log("âœ… BÃºiÃ° aÃ° spilast myndbandiÃ°. FjÃ¦rlÃ¦gum overlay...");
    videoOverlay.remove();
    document.body.style.overflowY = ""; // Restore scrolling
    return;
  }

    // Required attributes for mobile Safari
  video.muted = true;
  video.setAttribute("playsinline", "");
  video.setAttribute("webkit-playsinline", "");
  video.setAttribute("preload", "auto");

  // Try to load and play
  video.load();
  console.log("ðŸŽ¥ Reynum aÃ° spila mp4...");
  video.play().then(() => {
    console.log("ðŸŽ¬ mp4 virkar!");
  }).catch((error) => {
    console.error("âš ï¸ Autoplay failed. Error details:", error);
    if (error.name === "NotAllowedError") {
      console.warn("Autoplay is not allowed. Retrying with muted video...");
    } else if (error.name === "NotSupportedError") {
      console.error("The video format is not supported.");
    }
    video.muted = true; // Ensure the video is muted
    video.load(); // Reload the video
    video.play(); // Retry playback
  });

  // When the video ends, fade out and remove the overlay
  video.addEventListener("ended", () => {
    console.log("ðŸŽ¥ .mp4 virkar og er bÃºiÃ°! fade-out...");
    setTimeout(() => {
      videoOverlay.style.transition = "opacity 1s ease-out";
      videoOverlay.style.opacity = "0";

      // Let the fade animation finish before removing
      setTimeout(() => {
        console.log("ðŸ§¹ Overlay fjarlÃ¦gt...");
        videoOverlay.remove();
        document.body.style.overflowY = "";
        document.body.style.visibility = "visible";
        sessionStorage.setItem("vhsPlayed", "true");
        console.log("ðŸ“¦ sessionStorage uppfÃ¦rt: vhsPlayed =", sessionStorage.getItem("vhsPlayed"));
      }, 1000); // Wait for fade-out animation
    }, 100); // Slight delay helps iOS Safari render
  });

  // Disable scrolling while the video is playing
  document.body.style.overflowY = "hidden";
});

// Ensure the script also runs on Turbo cache restored pages
document.addEventListener("turbo:render", () => {
  console.log("ðŸ•º Turbo Render Ã­ gang!");
});




</script>
