<body class="music-body">

<div class="music-latest-main-container">
<div class="latest-music-container" data-controller="music-popup">
  <h1>latest music.</h1>
  <div class="latest-music">

    <% if defined?(@songs) && @songs.present? %>
      <% hardcoded_slugs = %w[vol_1 scream little-me child those-were-the-times twenties-album] %>
      <% @songs.each do |song| %>
        <% next if hardcoded_slugs.include?(song.slug) %>
        <div class="music-item <%= 'coming-soon' if song.respond_to?(:coming_soon_active?) && song.coming_soon_active? %>"
             <% unless song.respond_to?(:coming_soon_active?) && song.coming_soon_active? %>data-action="click->music-popup#open"<% end %>
             data-song="<%= song.slug %>">
          <% if song.respond_to?(:image) && song.image.attached? %>
            <%= image_tag song.image, alt: song.title %>
          <% elsif song.respond_to?(:asset_image_name) && asset_exists?(song.asset_image_name) %>
            <%= image_tag song.asset_image_name, alt: song.title %>
          <% else %>
            <%= image_tag "AKAII.png", alt: song.title %>
          <% end %>
          <% if song.respond_to?(:coming_soon_active?) && song.coming_soon_active? %>
            <div class="coming-soon-overlay">
              <% if song.respond_to?(:release_date) && song.release_date.present? %>
                Release date: <%= song.release_date.in_time_zone.strftime('%b %e, %Y • %l:%M%P %Z') %>
              <% else %>
                Coming soon
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <!-- Coming Soon -->
    <div class="music-item" data-song="vol_1">
      <%= image_tag "EP 3 CLEAN COVER.png", alt: "Vol. 1  Aron Hannes & Creature of Habit" %>
    </div>

    <!-- New Song -->
    <div class="music-item" data-action="click->music-popup#open" data-song="scream">
      <%= image_tag "SCREAM (BOLD:YELLOW).png", alt: "Scream  Aron Hannes ft.Diljá" %>
    </div>

    <!-- New Song -->
    <div class="music-item" data-action="click->music-popup#open" data-song="little-me">
      <%= image_tag "Little ME (excl. SNNY).png", alt: "Little ME - Aron Hannes ft.snny" %>
    </div>

    <!-- First Song -->
    <div class="music-item" data-action="click->music-popup#open" data-song="child">
      <%= image_tag "Child New TEXT.png", alt: "Child - Aron Hannes" %>
    </div>

    <!-- Second Song -->
    <div class="music-item" data-action="click->music-popup#open" data-song="those-were-the-times">
      <%= image_tag "twtt.jpg", alt: "Those Were The Times - Aron Hannes" %>
    </div>

    <!-- Third Song -->
    <div class="music-item" data-action="click->music-popup#open" data-song="twenties-album">
      <%= image_tag "Twenties art final.jpg", alt: "Twenties - Aron Hannes" %>
    </div>



  </div>

  <!-- Popup Window - MUST BE INSIDE THE CONTROLLER'S SCOPE -->
  <div id="music-popup" class="popup" data-music-popup-target="popup">
    <div class="popup-content">
      <span class="close" data-action="click->music-popup#close">&times;</span>
      <h2 data-music-popup-target="title">Title Placeholder</h2>  <!-- ✅ Title Target Exists -->
      <p>Listen on:</p>
      <ul data-music-popup-target="links"></ul>  <!-- ✅ Links Target Exists -->
    </div>
  </div>
</div>
</div>

</body>
